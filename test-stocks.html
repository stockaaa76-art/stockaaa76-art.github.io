<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ ªå¼ä¸€è¦§ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { color: red; }
        .success { color: green; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>ğŸ“Š æ ªå¼ä¸€è¦§ãƒ†ã‚¹ãƒˆ</h1>
    
    <div id="status">èª­è¾¼ä¸­...</div>
    
    <table id="stocks-table" style="display: none;">
        <thead>
            <tr>
                <th>ãƒ†ã‚£ãƒƒã‚«ãƒ¼</th>
                <th>éŠ˜æŸ„å</th>
                <th>å¸‚å ´</th>
                <th>ä¾¡æ ¼</th>
                <th>å¤‰åŒ–ç‡</th>
            </tr>
        </thead>
        <tbody id="stocks-tbody">
        </tbody>
    </table>

    <script>
    async function loadStocks() {
        const statusDiv = document.getElementById('status');
        const table = document.getElementById('stocks-table');
        const tbody = document.getElementById('stocks-tbody');
        
        try {
            statusDiv.textContent = 'APIãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...';
            statusDiv.className = '';
            
            const response = await fetch('/api/stocks/index.json');
            console.log('API Response Status:', response.status);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            console.log('å–å¾—ãƒ‡ãƒ¼ã‚¿:', data);
            
            if (!data.stocks || !Array.isArray(data.stocks)) {
                throw new Error('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼');
            }
            
            // æ—¥æœ¬æ ªã®ã¿ãƒ•ã‚£ãƒ«ã‚¿
            const jpStocks = data.stocks.filter(stock => stock.market === 'JP');
            console.log('æ—¥æœ¬æ ªæ•°:', jpStocks.length);
            
            if (jpStocks.length === 0) {
                statusDiv.textContent = 'æ—¥æœ¬æ ªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                statusDiv.className = 'error';
                return;
            }
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
            tbody.innerHTML = jpStocks.map(stock => `
                <tr>
                    <td>${stock.symbol}</td>
                    <td>${stock.name}</td>
                    <td>${stock.market}</td>
                    <td>${stock.price.toFixed(2)}</td>
                    <td>${stock.change_pct.toFixed(2)}%</td>
                </tr>
            `).join('');
            
            statusDiv.textContent = `âœ… æ—¥æœ¬æ ª ${jpStocks.length}éŠ˜æŸ„ã‚’è¡¨ç¤ºä¸­`;
            statusDiv.className = 'success';
            table.style.display = 'block';
            
        } catch (error) {
            console.error('ã‚¨ãƒ©ãƒ¼:', error);
            statusDiv.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            statusDiv.className = 'error';
        }
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', loadStocks);
    </script>
</body>
</html>